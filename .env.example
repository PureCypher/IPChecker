# ═════════════════════════════════════════════════════
# Server Configuration
# ═════════════════════════════════════════════════════
NODE_ENV=production
PORT=3000
PUBLIC_APP_NAME=IP Intelligence Correlator

# Admin API Key (REQUIRED - protects sensitive endpoints)
# SECURITY: Must be at least 32 characters in production. Server will refuse to start without it.
# Generate a secure key with one of these commands:
#   openssl rand -base64 32
#   python3 -c "import secrets; print(secrets.token_urlsafe(32))"
#   node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
ADMIN_API_KEY=

# API Key Authentication for Lookup Endpoints
# When true, all /api/v1/lookup* endpoints require a valid API key.
# Keys are managed via the admin endpoints (POST/GET/DELETE /api/v1/admin/keys).
# Provide the key via the X-API-Key header or ?api_key= query parameter.
# Default: true in production, false in development.
REQUIRE_API_KEY=true

# ═════════════════════════════════════════════════════
# Infrastructure Credentials
# ═════════════════════════════════════════════════════
# SECURITY: These passwords are required for docker-compose. Generate strong values:
#   openssl rand -base64 24

# PostgreSQL password (REQUIRED for docker-compose)
POSTGRES_PASSWORD=
# Redis password (REQUIRED for docker-compose)
REDIS_PASSWORD=

# ═════════════════════════════════════════════════════
# Infrastructure URLs
# ═════════════════════════════════════════════════════
# These are constructed automatically in docker-compose.yml using the passwords above.
# Only set these manually if connecting to external / non-Docker instances.
# REDIS_URL=redis://:<REDIS_PASSWORD>@localhost:6379
# DATABASE_URL=postgresql://postgres:<POSTGRES_PASSWORD>@localhost:5432/ipintel

# ═════════════════════════════════════════════════════
# Provider API Keys (leave blank to disable)
# ═════════════════════════════════════════════════════
# ipinfo.io - Free tier: 50k requests/month
# Sign up: https://ipinfo.io/signup
IPINFO_TOKEN=

# ipdata.co - Free tier: 1.5k requests/day
# Sign up: https://ipdata.co/sign-up.html
IPDATA_KEY=

# AbuseIPDB - Free tier: 1k requests/day
# Sign up: https://www.abuseipdb.com/register
ABUSEIPDB_KEY=

# Shodan - Paid API
# Sign up: https://account.shodan.io/register
SHODAN_KEY=

# ipgeolocation.io - Free tier: 1k requests/day
# Sign up: https://ipgeolocation.io/signup.html
IPGEOLOCATION_KEY=

# VirusTotal - Free tier: 4 requests/min
# Sign up: https://www.virustotal.com/gui/join-us
VIRUSTOTAL_KEY=

# AlienVault OTX - Free with registration
# Sign up: https://otx.alienvault.com/
ALIENVAULT_OTX_KEY=

# GreyNoise - Optional (community API works without key)
# Sign up: https://www.greynoise.io/plans/community
GREYNOISE_KEY=

# ═════════════════════════════════════════════════════
# CTI (Cyber Threat Intelligence) Platforms
# ═════════════════════════════════════════════════════
# CrowdSec CTI - Free tier: 50 queries/day
# Sign up: https://app.crowdsec.net/
CROWDSEC_KEY=

# IPQualityScore - Free tier: 5,000 lookups/month
# Sign up: https://www.ipqualityscore.com/create-account
IPQUALITYSCORE_KEY=

# Pulsedive - Free tier: 30 queries/day
# Sign up: https://pulsedive.com/register
PULSEDIVE_KEY=

# IBM X-Force Exchange - Free with registration
# Sign up: https://exchange.xforce.ibmcloud.com/
# Format: apikey:password
IBM_XFORCE_KEY=

# abuse.ch (URLhaus, ThreatFox, Feodo Tracker) - Free, no key needed
# Automatically enabled

# ═════════════════════════════════════════════════════
# VPN/Proxy Detection Providers
# ═════════════════════════════════════════════════════
# VPNapi.io - Free tier: 1,000 requests/day
# Sign up: https://vpnapi.io/
VPNAPI_KEY=

# IPHub - Free tier: 1,000 requests/day
# Sign up: https://iphub.info/api
IPHUB_KEY=

# ProxyCheck.io - Free tier works without key (limited features)
# Sign up: https://proxycheck.io/
PROXYCHECK_KEY=

# ═════════════════════════════════════════════════════
# Optional Provider Toggles
# ═════════════════════════════════════════════════════
# Cisco Talos - Disabled by default (blocks automated access with 403)
# Set to 'true' only if you have special access or can bypass restrictions
ENABLE_CISCO_TALOS=false

# MalwareBazaar - Disabled by default (limited IP lookup support)
# Set to 'true' to enable recent malware sample correlation
ENABLE_MALWAREBAZAAR=false

# Provider trust ranks (1-10, higher = more trusted for conflict resolution)
IPINFO_TRUST_RANK=8
IPDATA_TRUST_RANK=7
IPAPI_TRUST_RANK=6
ABUSEIPDB_TRUST_RANK=9
SHODAN_TRUST_RANK=8
IPGEOLOCATION_TRUST_RANK=7
VIRUSTOTAL_TRUST_RANK=9
THREATMINER_TRUST_RANK=7
ALIENVAULT_TRUST_RANK=8
GREYNOISE_TRUST_RANK=8
BGPVIEW_TRUST_RANK=6
CROWDSEC_TRUST_RANK=9
IPQUALITYSCORE_TRUST_RANK=9
PULSEDIVE_TRUST_RANK=8
ABUSECH_TRUST_RANK=9
TORPROJECT_TRUST_RANK=7
BLOCKLISTDE_TRUST_RANK=8
CISCOTALOS_TRUST_RANK=8
CINSARMY_TRUST_RANK=8
SPAMHAUS_TRUST_RANK=9
MALWAREBAZAAR_TRUST_RANK=9
IBM_XFORCE_TRUST_RANK=9
SANSISC_TRUST_RANK=8
VPNAPI_TRUST_RANK=8
PROXYCHECK_TRUST_RANK=8
IPHUB_TRUST_RANK=8

# ═════════════════════════════════════════════════════
# LLM Configuration
# ═════════════════════════════════════════════════════
# Provider: "ollama" (local) or "openai" (cloud OpenAI-compatible API)
# Cloud providers: Groq, Together AI, OpenRouter, Fireworks AI, OpenAI, etc.
LLM_PROVIDER=openai

# ── Cloud API Settings (when LLM_PROVIDER=openai) ──
# API key for your cloud LLM provider
LLM_API_KEY=

# API base URL (change for different providers):
#   Groq:        https://api.groq.com/openai/v1
#   Together AI: https://api.together.xyz/v1
#   OpenRouter:  https://openrouter.ai/api/v1
#   Fireworks:   https://api.fireworks.ai/inference/v1
#   OpenAI:      https://api.openai.com/v1
LLM_API_URL=https://api.groq.com/openai/v1

# Model name (varies by provider):
#   Groq:        llama-3.3-70b-versatile, mixtral-8x7b-32768
#   Together AI: meta-llama/Llama-3.3-70B-Instruct-Turbo
#   OpenRouter:  meta-llama/llama-3.3-70b-instruct
#   Fireworks:   accounts/fireworks/models/llama-v3p3-70b-instruct
#   OpenAI:      gpt-4o-mini, gpt-4o
LLM_MODEL=llama-3.3-70b-versatile

# ── Ollama Settings (when LLM_PROVIDER=ollama) ──
# Ollama API URL:
#   Local Docker:  http://ollama:11434
#   Ollama Cloud:  https://ollama.com
OLLAMA_URL=https://ollama.com

# Ollama Cloud API key (get from https://ollama.com/settings/keys)
# Leave blank for local Ollama (no auth needed)
OLLAMA_API_KEY=

# Model to use (see https://ollama.com/search?c=cloud for cloud models)
# Cloud options: hf.co/mistralai/Mistral-Small-24B-Instruct-2501, etc.
# Local options: tinyllama:latest, mistral:latest, qwen2.5:3b, etc.
OLLAMA_MODEL=hf.co/mistralai/Mistral-Small-24B-Instruct-2501

# ── Shared Settings ──
# Enable/disable LLM-powered threat analysis
LLM_ENABLED=true

# Timeout for LLM requests (milliseconds)
LLM_TIMEOUT_MS=30000

# ═════════════════════════════════════════════════════
# Performance Tuning
# ═════════════════════════════════════════════════════
# Global timeout for all providers (milliseconds)
LOOKUP_GLOBAL_TIMEOUT_MS=10000

# Max concurrent provider requests across all lookups
PROVIDER_CONCURRENCY=4

# Per-provider timeout (milliseconds)
PROVIDER_TIMEOUT_MS=3000

# Number of retry attempts per provider on failure
PROVIDER_RETRIES=2

# Delay between retries (milliseconds)
PROVIDER_RETRY_DELAY_MS=500

# ═════════════════════════════════════════════════════
# Rate Limiting
# ═════════════════════════════════════════════════════
# Requests per minute per client IP
RATE_LIMIT_PER_MINUTE=60

# Burst tolerance (additional requests allowed in short bursts)
RATE_LIMIT_BURST=10

# Cooldown period after exceeding limit (seconds)
RATE_LIMIT_BLOCK_DURATION=300

# ═════════════════════════════════════════════════════
# High Load Detection Thresholds
# ═════════════════════════════════════════════════════
# Event loop lag threshold (milliseconds)
HIGH_LOAD_EVENT_LOOP_LAG_MS=50

# P95 latency threshold (milliseconds)
HIGH_LOAD_P95_LATENCY_MS=800

# Redis connection pool usage threshold (percent)
HIGH_LOAD_REDIS_POOL_USAGE_PCT=80

# PostgreSQL active connections threshold
HIGH_LOAD_POSTGRES_CONNECTIONS=18

# Pending queue jobs threshold
HIGH_LOAD_PENDING_JOBS=100

# ═════════════════════════════════════════════════════
# Cache Configuration
# ═════════════════════════════════════════════════════
# Time-to-live for cached records (seconds)
# Default: 2592000 = 30 days
CACHE_TTL_SECONDS=2592000

# Threshold for refreshing cache (seconds)
# If TTL remaining < threshold, refresh in background
# Default: 2160000 = 25 days
CACHE_REFRESH_THRESHOLD_SECONDS=2160000

# ═════════════════════════════════════════════════════
# Observability
# ═════════════════════════════════════════════════════
# Log level: debug | info | warn | error
LOG_LEVEL=info

# Pretty print logs in development (slower but readable)
LOG_PRETTY=false

# Sentry DSN for error tracking (optional)
SENTRY_DSN=

# Sentry environment
SENTRY_ENVIRONMENT=production

# ═════════════════════════════════════════════════════
# Circuit Breaker Configuration
# ═════════════════════════════════════════════════════
# Failures before opening circuit
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Time before attempting to close circuit (milliseconds)
CIRCUIT_BREAKER_RESET_TIMEOUT_MS=60000

# Number of test requests in half-open state
CIRCUIT_BREAKER_HALF_OPEN_ATTEMPTS=1
